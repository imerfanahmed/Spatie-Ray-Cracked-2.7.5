{"version":3,"file":"index-3bd71159.js","sources":["../../src/pages/license/components/Label.tsx","../../src/pages/license/components/Input.tsx","../../src/pages/license/components/Button.tsx","../../src/pages/license/index.tsx"],"sourcesContent":["import React, { PropsWithChildren } from 'react';\n\nexport default function Label({ htmlFor, children }: PropsWithChildren<{ htmlFor?: string }>){\n\treturn (\n\t\t<label htmlFor={htmlFor} className=\"font-semibold text-sm text-gray-500 dark:text-gray-400\">\n\t\t\t{children}\n\t\t</label>\n\t);\n}","import React, { ComponentProps } from 'react';\n\ntype Props = Omit<ComponentProps<'input'>, 'onChange' | 'className'> & {\n\tonChange?: (value: string) => void;\n};\n\nexport default function Input({\n\tonChange = () => {},\n\t...props\n}: Props) {\n\treturn (\n\t\t<input\n\t\t\t{...props}\n\t\t\tclassName=\"\n                app-region-no-drag\n                w-full px-4 h-10\n                bg-gray-100 outline-none rounded-sm\n                text-gray-700 focus:text-indigo-700 focus:bg-indigo-50\n            \"\n\t\t\tonChange={(e) => onChange(e.target.value)}\n\t\t/>\n\t);\n}\n","import React from 'react';\n\ntype Props = {\n    id?: string;\n    children: React.ReactNode;\n    disabled?: boolean;\n    onClick?: () => void;\n    variant?: 'default' | 'secondary';\n};\n\nconst variants = {\n    default: 'bg-indigo-500 hover:bg-indigo-600 text-white disabled:bg-gray-500 disabled:hover:bg-gray-500',\n    secondary: 'bg-indigo-500/10 hover:bg-indigo-400/10 text-indigo-400 disabled:bg-gray-500/50 disabled:hover:bg-gray-500/50',\n};\n\nexport default function Button({ id, children, disabled, onClick, variant = 'default' }: Props) {\n    return (\n        <button\n            id={id}\n            className={`\n                py-2 px-4\n                font-medium \n                focus:outline-none focus:ring-0\n                ${variants[variant]}\n                rounded\n                transform active:translate-y-px\n                cursor-default select-none app-region-no-drag\n            `}\n            disabled={disabled}\n            onClick={onClick}\n        >\n            {children}\n        </button>\n    );\n}\n","import React, { FormEvent, useEffect, useState } from 'react';\nimport Label from './components/Label';\nimport Input from './components/Input';\nimport Button from './components/Button';\nimport useLicense from '@/stores/license';\nimport ExternalLink from '@/components/ui/ExternalLink';\n\nconst errorMessages = {\n    unexpected: 'The license server gave an unexpected response, please try again',\n    expired: (\n        <span>\n            This license has expired. <ExternalLink href=\"https://spatie.be/profile/purchases\" className=\"font-bold text-red-600 hover:text-red-500\">\n                Click here\n            </ExternalLink> to renew it\n        </span>\n    ),\n    notActivated: \"Your license is not valid or this device isn't activated anymore\",\n    invalid: 'This license is not valid, please check your input',\n    networkFailed: 'You might not be connected to the internet, please try again later',\n    noSeatsAvailable: 'todo',\n} as const;\n\n\n\n\nexport default function License() {\n    return (\n        <main className=\"px-4\">\n            <LicenseForm />\n        </main>\n    );\n}\n\nexport function Header() {\n    return (\n        <span className=\"text-sm font-bold absolute inset-0 flex justify-center items-center text-center\">\n            License\n        </span>\n    );\n}\n\n\nfunction LicenseForm() {\n    const license = useLicense();\n    const [isLoading, setIsLoading] = useState(false);\n\n    const [inputLicenseKey, setInputLicenseKey] = useState(license.isValid ? license.license_key || '' : '');\n    const isLicenseOverlayLocked = license.is_overlay_locked;\n    const errorMessage = license.error_message;\n\n    async function handleSubmit(e?: FormEvent<HTMLFormElement>) {\n        e?.preventDefault();\n        if (isLoading || !inputLicenseKey) {\n            return;\n        }\n\n        setIsLoading(true);\n        await window.Ray.submitLicense({ licenseKey: inputLicenseKey });\n        setIsLoading(false);\n    }\n\n    if (errorMessage === 'networkFailed') {\n        return <NetworkRetry />;\n    }\n\n    return (\n        <div className=\"relative mx-auto max-w-xl grid py-12\">\n            <div className=\"md:flex items-center justify-between text-sm\">\n                <h1 className=\"markup-h1\">Enter license</h1>\n                <ExternalLink href=\"https://spatie.be/profile/purchases\">\n                    Manage your licenses\n                </ExternalLink>\n            </div>\n\n            <div className=\"mt-8\">\n                <p className=\"font-bold mb-2\">\n                    {license.has_grace_period_expired &&\n                        'Ray has not been successful in checking your license in 7 days. Please make sure Ray can access the internet to disable demo mode.'}\n                    {!license.isValid && 'There is no license key registered to this device.'}\n                    {license?.is_expired && 'Your license key has expired.'}\n                </p>\n                <p>\n                    Please buy a license or renew your existing license on{' '}\n                    <ExternalLink href=\"https://spatie.be/products/ray\">\n                        spatie.be/products/ray\n                    </ExternalLink>\n                    .\n                </p>\n\n                {license.isValid && (\n                    <p>\n                        <button\n                            type=\"button\"\n                            className=\"text-indigo-500 hover:text-indigo-600 underline\"\n                            onClick={() => window.Ray.checkLicense()}\n                        >\n                            Click here\n                        </button> after renewing to reload.\n                </p>\n                )}\n            </div>\n            <p className=\"mt-2\">In trial mode you can send up to 10 log items before the app locks.</p>\n            <form onSubmit={handleSubmit}>\n                <div className=\"grid gap-2 mt-4\">\n                    <Label htmlFor=\"license\">License key</Label>\n                    <Input\n                        id=\"license\"\n                        value={inputLicenseKey}\n                        onChange={setInputLicenseKey}\n                    />\n                </div>\n\n                <div className=\"mt-6 flex flex-wrap gap-6 items-center\">\n                    <Button\n                        id=\"activate-license\"\n                        disabled={isLoading || !inputLicenseKey}\n                    >\n                        Activate on this device\n                    </Button>\n                    {!isLicenseOverlayLocked && (\n                        <div className=\"my-4\">\n                            <button\n                                onClick={() => window.Ray.closeLicenseWindow()}\n                                className=\"text-indigo-500 hover:text-indigo-600 underline text-sm cursor-pointer app-region-no-drag\"\n                            >\n                                Continue in trial mode\n                            </button>\n                        </div>\n                    )}\n                </div>\n            </form>\n\n            {errorMessage && (\n                <p id=\"license-error-message\" className=\"mt-4 py-2 px-4 text-red-600 bg-red-500/20 text-sm\">\n                    {errorMessages[errorMessage]}\n                </p>\n            )}\n        </div>\n    );\n}\n\nfunction useIsOnline() {\n    const [isOnline, setIsOnline] = useState(navigator.onLine);\n\n    useEffect(() => {\n        window.addEventListener('offline', () => {\n            setIsOnline(false);\n        });\n        window.addEventListener('online', () => {\n            setIsOnline(true);\n        });\n\n        return () => {\n            window.removeEventListener('offline', () => {\n                setIsOnline(false);\n            });\n            window.removeEventListener('online', () => {\n                setIsOnline(true);\n            });\n        };\n    }, []);\n\n    return isOnline;\n}\n\n\nfunction NetworkRetry() {\n    const isOnline = useIsOnline();\n    const license = useLicense();\n    const [isChecking, setIsChecking] = useState(false);\n\n\n    useEffect(() => {\n        if (!isOnline) return;\n        if (isChecking) return;\n        setIsChecking(true);\n        window.Ray.checkLicense().then(() => {\n            setIsChecking(false);\n        });\n    }, [isOnline, isChecking]);\n\n    if (!isOnline) {\n        return (\n            <div>\n                <p id=\"license-error-message\" className=\"mt-4 py-2 px-4 text-red-600 bg-red-500/20 text-sm\">\n                                The Ray app seams to be unable to access to internet. Please try again later or <a href=\"#\" className=\"underline\">troubleshoot</a> this problem.\n                </p>\n            </div>\n        );\n    }\n\n    async function handleRetry() {\n        setIsChecking(true);\n        await window.Ray.checkLicense();\n        setIsChecking(false);\n    }\n\n    return (\n        <div className=\"relative mx-auto max-w-xl grid py-12\">\n            <div className=\"md:flex items-center justify-between text-sm\">\n                <h1 className=\"markup-h1\">License</h1>\n                <ExternalLink href=\"https://spatie.be/profile/purchases\">\n                    Manage your licenses\n                </ExternalLink>\n            </div>\n            <div className=\"mt-8\">\n                <p className=\"mb-2\">\n                    Ray has not been successful in checking your license.\n                </p>\n                <div className=\"mt-6 flex flex-wrap gap-6 items-center\">\n                    <Button onClick={handleRetry} disabled={isChecking}>\n                        validate your license\n                    </Button>\n                    or\n                    <Button onClick={() => license.decouple!()} variant=\"secondary\" disabled={isChecking}>\n                        decouple your license from this device\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":["Label","htmlFor","children","jsx","Input","onChange","props","e","variants","Button","id","disabled","onClick","variant","errorMessages","ExternalLink","License","LicenseForm","Header","license","useLicense","isLoading","setIsLoading","useState","inputLicenseKey","setInputLicenseKey","isLicenseOverlayLocked","errorMessage","handleSubmit","NetworkRetry","jsxs","useIsOnline","isOnline","setIsOnline","useEffect","isChecking","setIsChecking","handleRetry"],"mappings":"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"}